<!--
    Digital clock

    Author: Brandon Michael Weaver
    Date: May, 21, 2021
-->

<!DOCTYPE html>
<html>
    <head>
        <title>Digital clock</title>
        <link rel="stylesheet" href="./index.css" />
    </head>
    <body>
        <div class="viewport">
            <div class="scene">
                <div class="clock__front face">
                    <div class="display">
                        <div class="message__display">
                            <p></p>
                            <div class="overlay"></div>
                        </div>
                        <div class="date__display">
                            <p></p>
                            <p></p>
                            <p></p>
                            <p></p>
                        </div>
                        <div class="digit__box">
                            <div class="digit__section top" style="border-top-left-radius: 10px; border-top-right-radius: 10px;"></div>
                            <div class="digit__section top" style="top: 50%;"></div>
                            <div class="digit__section right" style="top: 5px; border-top-right-radius: 10px;"></div>
                            <div class="digit__section right" style="bottom: 5px; border-bottom-right-radius: 10px;"></div>
                            <div class="digit__section bottom" style="border-bottom-right-radius: 10px; border-bottom-left-radius: 10px;"></div>
                            <div class="digit__section left" style="bottom: 5px; border-bottom-left-radius: 10px;"></div>
                            <div class="digit__section left" style="top: 5px; border-top-left-radius: 10px;"></div>
                        </div>
                        <div class="digit__box">
                            <div class="digit__section top" style="border-top-left-radius: 10px; border-top-right-radius: 10px;"></div>
                            <div class="digit__section top" style="top: 50%;"></div>
                            <div class="digit__section right" style="top: 5px; border-top-right-radius: 10px;"></div>
                            <div class="digit__section right" style="bottom: 5px; border-bottom-right-radius: 10px;"></div>
                            <div class="digit__section bottom" style="border-bottom-right-radius: 10px; border-bottom-left-radius: 10px;"></div>
                            <div class="digit__section left" style="bottom: 5px; border-bottom-left-radius: 10px;"></div>
                            <div class="digit__section left" style="top: 5px; border-top-left-radius: 10px;"></div>
                        </div>
                        <div class="divider">
                            <div class="dot"></div>
                            <div class="dot"></div>
                        </div>
                        <div class="digit__box">
                            <div class="digit__section top" style="border-top-left-radius: 10px; border-top-right-radius: 10px;"></div>
                            <div class="digit__section top" style="top: 50%;"></div>
                            <div class="digit__section right" style="top: 5px; border-top-right-radius: 10px;"></div>
                            <div class="digit__section right" style="bottom: 5px; border-bottom-right-radius: 10px;"></div>
                            <div class="digit__section bottom" style="border-bottom-right-radius: 10px; border-bottom-left-radius: 10px;"></div>
                            <div class="digit__section left" style="bottom: 5px; border-bottom-left-radius: 10px;"></div>
                            <div class="digit__section left" style="top: 5px; border-top-left-radius: 10px;"></div>
                        </div>
                        <div class="digit__box">
                            <div class="digit__section top" style="border-top-left-radius: 10px; border-top-right-radius: 10px;"></div>
                            <div class="digit__section top" style="top: 50%;"></div>
                            <div class="digit__section right" style="top: 5px; border-top-right-radius: 10px;"></div>
                            <div class="digit__section right" style="bottom: 5px; border-bottom-right-radius: 10px;"></div>
                            <div class="digit__section bottom" style="border-bottom-right-radius: 10px; border-bottom-left-radius: 10px;"></div>
                            <div class="digit__section left" style="bottom: 5px; border-bottom-left-radius: 10px;"></div>
                            <div class="digit__section left" style="top: 5px; border-top-left-radius: 10px;"></div>
                        </div>
                        <div class="divider">
                            <div class="dot"></div>
                            <div class="dot"></div>
                        </div>
                        <div class="digit__box">
                            <div class="digit__section top" style="border-top-left-radius: 10px; border-top-right-radius: 10px;"></div>
                            <div class="digit__section top" style="top: 50%;"></div>
                            <div class="digit__section right" style="top: 5px; border-top-right-radius: 10px;"></div>
                            <div class="digit__section right" style="bottom: 5px; border-bottom-right-radius: 10px;"></div>
                            <div class="digit__section bottom" style="border-bottom-right-radius: 10px; border-bottom-left-radius: 10px;"></div>
                            <div class="digit__section left" style="bottom: 5px; border-bottom-left-radius: 10px;"></div>
                            <div class="digit__section left" style="top: 5px; border-top-left-radius: 10px;"></div>
                        </div>
                        <div class="digit__box">
                            <div class="digit__section top" style="border-top-left-radius: 10px; border-top-right-radius: 10px;"></div>
                            <div class="digit__section top" style="top: 50%;"></div>
                            <div class="digit__section right" style="top: 5px; border-top-right-radius: 10px;"></div>
                            <div class="digit__section right" style="bottom: 5px; border-bottom-right-radius: 10px;"></div>
                            <div class="digit__section bottom" style="border-bottom-right-radius: 10px; border-bottom-left-radius: 10px;"></div>
                            <div class="digit__section left" style="bottom: 5px; border-bottom-left-radius: 10px;"></div>
                            <div class="digit__section left" style="top: 5px; border-top-left-radius: 10px;"></div>
                        </div>
                        <div class="divider">
                            <div class="meridiem">A.M.</div>
                            <div class="meridiem">P.M.</div>
                        </div>
                    </div>
                </div>
                <div class="clock__top face"></div>
                <div class="clock__right face"></div>
                <div class="clock__left face"></div>
                <div class="clock__corner top__right face"></div>
                <div class="clock__corner top__left face"></div>
                <div class="clock__corner bottom__right face"></div>
                <div class="clock__corner bottom__left face"></div>
                <div class="clock__back face">
                    <div class="panel__container">
                        <div class="panel">
                            <p class="engraving">Weaver Electronics</p>
                        </div>
                    </div>
                    <div class="screw" style="top: 25px; left: 25px;">
                        <div class="screw__shading">+</div>
                    </div>
                    <div class="screw" style="top: 25px; right: 25px;">
                        <div class="screw__shading">+</div>
                    </div>
                    <div class="screw" style="bottom: 25px; right: 25px;">
                        <div class="screw__shading">+</div>
                    </div>
                    <div class="screw" style="bottom: 25px; left: 25px;">
                        <div class="screw__shading">+</div>
                    </div>
                </div>
                <div class="clock__refraction">
                    <div class="radius"></div>
                </div>
            </div>
            <header>
                <div class="color__selector">
                    <button onclick="changeDisplayColor(event)" style="background-color: #ffffff;"></button>
                    <button onclick="changeDisplayColor(event)" style="background-color: #ff3705;"></button>
                    <button onclick="changeDisplayColor(event)" style="background-color: #ff059b;"></button>
                    <button onclick="changeDisplayColor(event)" style="background-color: #05ff9b;"></button>
                    <button onclick="changeDisplayColor(event)" style="background-color: #059bff;"></button>
                </div>
            </header>
            <footer>
                <div class="footer__panel">
                    <button class="on__off" onclick="powerDown()">
                        <div class="overlay"></div>
                    </button>
                    <div class="view__selector x__axis">
                        <button id="1" onclick="switchView(event)"></button>
                        <button id="2" onclick="switchView(event)" disabled></button>
                    </div>
                    <div class="view__selector y__axis">
                        <button id="3" onclick="switchView(event)"></button>
                        <button id="4" onclick="switchView(event)"></button>
                    </div>
                    <div class="rotate__scene__button__container">
                        <div class="rotate__scene__button__border">
                            <button onclick="rotateScene()"></button>
                        </div>
                    </div>
                </div>
            </footer>
        </div>
        <script>
            /* constants -> */
            const DOC_ROOT = document.querySelector(":root");
            const COLOR_SELECTOR_BUTTONS = document.querySelectorAll(".color__selector button");
            const VIEW_SELECTOR_BUTTONS = document.querySelectorAll(".view__selector button");
            const ROTATE_SCENE_BUTTON_CONTAINER = document.querySelector(".rotate__scene__button__container");
            const SCENE = document.querySelector(".scene");
            const MESSAGE_DISPLAY = document.querySelector(".message__display");
            const MESSAGE = MESSAGE_DISPLAY.children[0];
            const DATE_DISPLAY = document.querySelectorAll(".date__display p");
            const DIGIT_BOXES = document.querySelectorAll(".digit__box");
            const DOTS = document.querySelectorAll(".dot");
            const MERIDIEMS = document.querySelectorAll(".meridiem");
            const CLOCK_REFRACTION = document.querySelector(".clock__refraction");

            const DIVIDER_COLOR = "#ffffff";
            const MESSAGES = [
                "Digital clock - Brandon Weaver",
                "Built with HTML, CSS, and plain old JavaScript",
                "Thanks for checking it out!"
            ];
            /* <- constants */

            /* variables -> */
            let on = true;
            let displayColor = "#ffffff";
            let offStateDisplayColor = "#ffffff";
            let currentlySelectedColorButton = COLOR_SELECTOR_BUTTONS[0];
            let meridiem = "AM";
            let currentMessageIndex = 0;
            /* <- variables */

            // color dividers
            for (const dot of DOTS) {
                dot.style.backgroundColor = DIVIDER_COLOR;
            }

            // colorSelectorButton -> removes the box shadow of this button while setting the box shadow of all other color selector buttons
            const setSelectedColorSelectorButton = colorSelectorButton => {
                for (const button of COLOR_SELECTOR_BUTTONS) {
                    button.disabled = false;
                    button.style.boxShadow = "0 5px 5px #050505";
                }
                colorSelectorButton.disabled = true;
                colorSelectorButton.style.boxShadow = "none";
            }

            // meridiem -> "AM" or "PM"
            // the proper meridiem is set accordingly
            const setMeridiem = meridiem => {
                if (meridiem === "AM") {
                    MERIDIEMS[0].style.color = "#ffffff";
                    MERIDIEMS[1].style.color = "#ffffff05";
                }
                else {
                    MERIDIEMS[0].style.color = "#ffffff05";
                    MERIDIEMS[1].style.color = "#ffffff";
                }
            }

            // result(current time) -> ["hhmmss", [ddd, mmm, d, y]]
            const getCurrentTime = () => {
                let time = new Date().toLocaleString("en-US", {
                    hour12: true,
                    hour: "2-digit",
                    minute: "2-digit",
                    second: "2-digit",
                    weekday: "short",
                    day: "2-digit",
                    month: "short",
                    year: "2-digit"
                }).split(':');

                const date = time[0].slice(0, -4).split(", ");
                const separatedDayInfo = date[1].split(' ');
                date[1] = separatedDayInfo[0];
                date.splice(2, 0, separatedDayInfo[1]);

                time = [time[0].slice(-2), time[1], time[2]];

                meridiem = time[time.length - 1].split(' ')[1];
                setMeridiem(meridiem);

                time[time.length - 1] = time[time.length - 1].split(' ')[0];

                return [time.join(''), date];
            }

            // rgb -> [255, 255, 255]
            // result(hex) -> "#ffffff"
            const convertRgbToHex = rgb => {
                const hex = [];
                for (const value of rgb) {
                    const conversion = parseInt(value).toString(16);
                    hex.push(conversion.length === 1 ? `0${conversion}` : conversion);
                }
                return `#${hex.join('')}`;
            }

            /*
                digit render data ->
                [
                    digit__section top,
                    digit__section top,
                    digit__section right,
                    digit__section right,
                    digit__section bottom,
                    digit__section left,
                    digit__section left
                ]
                0 -> off
                1 -> on
            */
            const empty = [0, 0, 0, 0, 0, 0, 0];
            const zero = [1, 0, 1, 1, 1, 1, 1];
            const one = [0, 0, 1, 1, 0, 0, 0];
            const two = [1, 1, 1, 0, 1, 1, 0];
            const three = [1, 1, 1, 1, 1, 0, 0];
            const four = [0, 1, 1, 1, 0, 0, 1];
            const five = [1, 1, 0, 1, 1, 0, 1];
            const six = [1, 1, 0, 1, 1, 1, 1];
            const seven = [1, 0, 1, 1, 0, 0, 0];
            const eight = [1, 1, 1, 1, 1, 1, 1];
            const nine = [1, 1, 1, 1, 0, 0, 1];
            /*
                <- digit render data
            */

            // takes an array of digit render data and changes the digit boxes digit sections according to that data
            const render = (digitRenderData, digitBox) => {
                for (let i = 0; i < digitRenderData.length; i++) {
                    if (digitRenderData[i] === 1)
                        digitBox.children[i].style.backgroundColor = displayColor;
                    else if (!on)
                        digitBox.children[i].style.backgroundColor = `${offStateDisplayColor}05`;
                    else
                        digitBox.children[i].style.backgroundColor = `${displayColor}05`;
                }
            }
            
            // number -> integer representation of the digit to be rendered
            // digitBox -> the element responsible for rendering the number
            const renderFromNumber = (number, digitBox) => {
                switch(number) {
                    case 0:
                        render(zero, digitBox);
                        break;
                    case 1:
                        render(one, digitBox);
                        break;
                    case 2:
                        render(two, digitBox);
                        break;
                    case 3:
                        render(three, digitBox);
                        break;
                    case 4:
                        render(four, digitBox);
                        break;
                    case 5:
                        render(five, digitBox);
                        break;
                    case 6:
                        render(six, digitBox);
                        break;
                    case 7:
                        render(seven, digitBox);
                        break;
                    case 8:
                        render(eight, digitBox);
                        break;
                    case 9:
                        render(nine, digitBox);
                        break;
                    case 10:
                        render(empty, digitBox);
                }
            }

            // result [x, y]
            const getSceneTransformCoords = () => {
                return [
                    parseInt(SCENE.style.transform.split("rotateX(")[1].split("deg)")[0]),
                    parseInt(SCENE.style.transform.split("rotateY(")[1].split("deg)")[0])
                ];
            }

            // renders each digit of the current time sequentially
            const update = (powerDown = false) => {
                const [currentTime, currentDate] = getCurrentTime();

                for (let i = 0; i < currentTime.length; i++) {
                    if (powerDown || i === 0 && parseInt(currentTime[i]) === 0)
                        renderFromNumber(10, DIGIT_BOXES[i]);
                    else
                        renderFromNumber(parseInt(currentTime[i]), DIGIT_BOXES[i]);
                }

                for (let i = 0; i < currentDate.length; i++)
                    DATE_DISPLAY[i].innerText = currentDate[i];
            }

            // changes the display color of the digital clock to the background color of the element which raised the event
            const changeDisplayColor = e => {
                setSelectedColorSelectorButton(e.target);
                currentlySelectedColorButton = e.target;

                const rgb = e.target.style.backgroundColor;
                const rgbValues = rgb.split('(')[1].split(')')[0].split(", ");
                displayColor = convertRgbToHex(rgbValues);

                if (on) {
                    CLOCK_REFRACTION.style.backgroundColor = displayColor;

                    update();
                }
            }

            const displayMessage = () => {
                if (currentMessageIndex === MESSAGES.length)
                    currentMessageIndex = 0;
                MESSAGE.innerText = MESSAGES[currentMessageIndex];
                MESSAGE.style.animation = "scrollMessage 30s infinite linear";
                
                ++currentMessageIndex;
            }

            const switchView = e => {
                e.target.disabled = true;

                if (e.target.id === '1')
                    VIEW_SELECTOR_BUTTONS[1].disabled = false;
                else if (e.target.id === '2')
                    VIEW_SELECTOR_BUTTONS[0].disabled = false;

                ROTATE_SCENE_BUTTON_CONTAINER.children[0].children[0].disabled = true;

                const [currentX, currentY] = getSceneTransformCoords();

                if (e.target.id === '1' && currentX > -180) {
                    SCENE.style.transform = `rotateX(${currentX - 15}deg) rotateY(${currentY}deg)`;
                    ROTATE_SCENE_BUTTON_CONTAINER.children[0].style.transform = `rotate(${currentY}deg)`;
                    VIEW_SELECTOR_BUTTONS[1].disabled = false;
                }
                else if (e.target.id === '2' && currentX < 0) {
                    SCENE.style.transform = `rotateX(${currentX + 15}deg) rotateY(${currentY}deg)`;
                    ROTATE_SCENE_BUTTON_CONTAINER.children[0].style.transform = `rotate(${currentY}deg)`;
                    VIEW_SELECTOR_BUTTONS[0].disabled = false;
                }
                else if (e.target.id === '3') {
                    SCENE.style.transform = `rotateX(${currentX}deg) rotateY(${currentY + 15}deg)`;
                    ROTATE_SCENE_BUTTON_CONTAINER.children[0].style.transform = `rotate(${currentY + 15}deg)`;
                }
                else if (e.target.id === '4') {
                    SCENE.style.transform = `rotateX(${currentX}deg) rotateY(${currentY - 15}deg)`;
                    ROTATE_SCENE_BUTTON_CONTAINER.children[0].style.transform = `rotate(${currentY - 15}deg)`;
                }

                setTimeout(() => {
                    console.log(currentX)
                    if (parseInt(e.target.id) > 2)
                        e.target.disabled = false;
                    else if (e.target.id === '1' && !(currentX - 15 === -75))
                        e.target.disabled = false;
                    else if (e.target.id === '2' && !(currentX + 15 === 0))
                        e.target.disabled = false;

                    ROTATE_SCENE_BUTTON_CONTAINER.children[0].children[0].disabled = false;
                }, 250);
            }

            const disableViewSelector = () => {
                for (const button of VIEW_SELECTOR_BUTTONS)
                    button.disabled = true;
            }

            const enableViewSelector = () => {
                const currentX = getSceneTransformCoords()[0];

                for (const button of VIEW_SELECTOR_BUTTONS)
                    if (button.id !== '1' && currentX !== 0 || button.id !== '2' && currentX !== -75 )
                        button.disabled = false;
            }

            const rotateScene = () => {
                ROTATE_SCENE_BUTTON_CONTAINER.children[0].children[0].disabled = true;
                disableViewSelector();

                const [currentX, currentY] = getSceneTransformCoords();
                DOC_ROOT.style.setProperty("--currentX", `${currentX}deg`);
                DOC_ROOT.style.setProperty("--currentY", `${currentY}deg`);

                ROTATE_SCENE_BUTTON_CONTAINER.children[0].style.animation = "rotateBorder 5s ease-in-out";
                SCENE.style.animation = "rotateScene 5s ease-in-out";

                setTimeout(() => {
                    ROTATE_SCENE_BUTTON_CONTAINER.children[0].style.animation = "none";
                    SCENE.style.animation = "none";

                    ROTATE_SCENE_BUTTON_CONTAINER.children[0].children[0].disabled = false;
                    enableViewSelector();
                }, 5000);
            }

            /* initial conditions -> */
            setSelectedColorSelectorButton(currentlySelectedColorButton);
            SCENE.style.transform = "rotateX(0deg) rotateY(0deg)";
            CLOCK_REFRACTION.style.backgroundColor = displayColor;
            update();
            let updateInterval = setInterval(update, 1000);
            displayMessage();
            let displayMessageInterval = setInterval(displayMessage, 30000);
            /* <- initial conditions */

            // conditions for power down
            const powerDown = () => {
                if (!on) {
                    powerUp();
                    return;
                }

                clearInterval(updateInterval);
                clearInterval(displayMessageInterval);

                on = false;
                offStateDisplayColor = displayColor;

                update(true);
                MESSAGE.style.color = "#05050500";
                for (const dot of DOTS)
                    dot.style.backgroundColor = "#ffffff05";
                for (const meridiem of MERIDIEMS)
                    meridiem.style.color = "#ffffff05";
                for (const section of DATE_DISPLAY)
                    section.style.color = "#050505";
                CLOCK_REFRACTION.style.backgroundColor = "#05050500";
            }

            // conditions for power up
            const powerUp = () => {
                setSelectedColorSelectorButton(currentlySelectedColorButton);
                for (const dot of DOTS)
                    dot.style.backgroundColor = "#ffffff";
                CLOCK_REFRACTION.style.backgroundColor = displayColor;

                on = true;

                update();
                updateInterval = setInterval(update, 1000);

                MESSAGE.remove();
                MESSAGE_DISPLAY.prepend(MESSAGE);
                MESSAGE.style.color = "#ffffff9b";
                if (currentMessageIndex === 0)
                    currentMessageIndex = MESSAGES[MESSAGES.length - 1];
                else
                    --currentMessageIndex;
                displayMessage();
                displayMessageInterval = setInterval(displayMessage, 30000);

                for (const section of DATE_DISPLAY)
                    section.style.color = "#ffffff9b";
            }
        </script>
    </body>
</html>
