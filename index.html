<!--
    Digital clock

    Author: Brandon Michael Weaver
    Date: May, 21, 2021
-->

<!DOCTYPE html>
<html>
    <head>
        <title>Digital clock</title>
        <link rel="stylesheet" href="./index.css" />
    </head>
    <body>
        <div class="clock__container">
            <div class="clock__front">
                <div class="clock">
                    <div class="message__display">
                        <p></p>
                        <div class="overlay"></div>
                    </div>
                    <div class="digit__box">
                        <div class="digit__section top" style="border-top-left-radius: 10px; border-top-right-radius: 10px;"></div>
                        <div class="digit__section top" style="top: 50%;"></div>
                        <div class="digit__section right" style="top: 5px; border-top-right-radius: 10px;"></div>
                        <div class="digit__section right" style="bottom: 5px; border-bottom-right-radius: 10px;"></div>
                        <div class="digit__section bottom" style="border-bottom-right-radius: 10px; border-bottom-left-radius: 10px;"></div>
                        <div class="digit__section left" style="bottom: 5px; border-bottom-left-radius: 10px;"></div>
                        <div class="digit__section left" style="top: 5px; border-top-left-radius: 10px;"></div>
                    </div>
                    <div class="digit__box">
                        <div class="digit__section top" style="border-top-left-radius: 10px; border-top-right-radius: 10px;"></div>
                        <div class="digit__section top" style="top: 50%;"></div>
                        <div class="digit__section right" style="top: 5px; border-top-right-radius: 10px;"></div>
                        <div class="digit__section right" style="bottom: 5px; border-bottom-right-radius: 10px;"></div>
                        <div class="digit__section bottom" style="border-bottom-right-radius: 10px; border-bottom-left-radius: 10px;"></div>
                        <div class="digit__section left" style="bottom: 5px; border-bottom-left-radius: 10px;"></div>
                        <div class="digit__section left" style="top: 5px; border-top-left-radius: 10px;"></div>
                    </div>
                    <div class="divider">
                        <div class="dot"></div>
                        <div class="dot"></div>
                    </div>
                    <div class="digit__box">
                        <div class="digit__section top" style="border-top-left-radius: 10px; border-top-right-radius: 10px;"></div>
                        <div class="digit__section top" style="top: 50%;"></div>
                        <div class="digit__section right" style="top: 5px; border-top-right-radius: 10px;"></div>
                        <div class="digit__section right" style="bottom: 5px; border-bottom-right-radius: 10px;"></div>
                        <div class="digit__section bottom" style="border-bottom-right-radius: 10px; border-bottom-left-radius: 10px;"></div>
                        <div class="digit__section left" style="bottom: 5px; border-bottom-left-radius: 10px;"></div>
                        <div class="digit__section left" style="top: 5px; border-top-left-radius: 10px;"></div>
                    </div>
                    <div class="digit__box">
                        <div class="digit__section top" style="border-top-left-radius: 10px; border-top-right-radius: 10px;"></div>
                        <div class="digit__section top" style="top: 50%;"></div>
                        <div class="digit__section right" style="top: 5px; border-top-right-radius: 10px;"></div>
                        <div class="digit__section right" style="bottom: 5px; border-bottom-right-radius: 10px;"></div>
                        <div class="digit__section bottom" style="border-bottom-right-radius: 10px; border-bottom-left-radius: 10px;"></div>
                        <div class="digit__section left" style="bottom: 5px; border-bottom-left-radius: 10px;"></div>
                        <div class="digit__section left" style="top: 5px; border-top-left-radius: 10px;"></div>
                    </div>
                    <div class="divider">
                        <div class="dot"></div>
                        <div class="dot"></div>
                    </div>
                    <div class="digit__box">
                        <div class="digit__section top" style="border-top-left-radius: 10px; border-top-right-radius: 10px;"></div>
                        <div class="digit__section top" style="top: 50%;"></div>
                        <div class="digit__section right" style="top: 5px; border-top-right-radius: 10px;"></div>
                        <div class="digit__section right" style="bottom: 5px; border-bottom-right-radius: 10px;"></div>
                        <div class="digit__section bottom" style="border-bottom-right-radius: 10px; border-bottom-left-radius: 10px;"></div>
                        <div class="digit__section left" style="bottom: 5px; border-bottom-left-radius: 10px;"></div>
                        <div class="digit__section left" style="top: 5px; border-top-left-radius: 10px;"></div>
                    </div>
                    <div class="digit__box">
                        <div class="digit__section top" style="border-top-left-radius: 10px; border-top-right-radius: 10px;"></div>
                        <div class="digit__section top" style="top: 50%;"></div>
                        <div class="digit__section right" style="top: 5px; border-top-right-radius: 10px;"></div>
                        <div class="digit__section right" style="bottom: 5px; border-bottom-right-radius: 10px;"></div>
                        <div class="digit__section bottom" style="border-bottom-right-radius: 10px; border-bottom-left-radius: 10px;"></div>
                        <div class="digit__section left" style="bottom: 5px; border-bottom-left-radius: 10px;"></div>
                        <div class="digit__section left" style="top: 5px; border-top-left-radius: 10px;"></div>
                    </div>
                    <div class="divider">
                        <div class="meridiem">A.M.</div>
                        <div class="meridiem">P.M.</div>
                    </div>
                </div>
            </div>
            <div class="clock__top"></div>
            <div class="clock__back"></div>
            <div class="clock__right"></div>
            <div class="clock__left"></div>
            <div class="clock__corner__right"></div>
            <div class="clock__corner__left"></div>
            <div class="clock__refraction">
                <div class="radius"></div>
            </div>
        </div>
        <header>
            <div class="color__selector">
                <button onclick="changeDisplayColor(event)" style="background-color: #ffffff;"></button>
                <button onclick="changeDisplayColor(event)" style="background-color: #ff3705;"></button>
                <button onclick="changeDisplayColor(event)" style="background-color: #ff059b;"></button>
                <button onclick="changeDisplayColor(event)" style="background-color: #05ff9b;"></button>
                <button onclick="changeDisplayColor(event)" style="background-color: #059bff;"></button>
            </div>
        </header>
        <footer>
            <div class="footer__panel">
                <button class="on__off" onclick="powerDown()">
                    <div class="overlay"></div>
                </button>
            </div>
        </footer>
        <div class="view__selector">
            <label class="radio__button__container">
                <input id="0" type="radio" name="view-option" onclick="switchView(event)" checked="checked" />
                <span class="overlay"></span>
            </label>
            <label class="radio__button__container">
                <input id="1" type="radio" name="view-option" onclick="switchView(event)" />
                <span class="overlay"></span>
            </label>
            <label class="radio__button__container">
                <input id="2" type="radio" name="view-option" onclick="switchView(event)" />
                <span class="overlay"></span>
            </label>
            <label class="radio__button__container">
                <input id="3" type="radio" name="view-option" onclick="switchView(event)" />
                <span class="overlay"></span>
            </label>
        </div>
        <script>
            /* constants -> */
            const COLOR_SELECTOR_BUTTONS = document.querySelectorAll(".color__selector button");
            const CLOCK_CONTAINER = document.querySelector(".clock__container");
            const MESSAGE_DISPLAY = document.querySelector(".message__display p");
            const DIGIT_BOXES = document.querySelectorAll(".digit__box");
            const DOTS = document.querySelectorAll(".dot");
            const MERIDIEMS = document.querySelectorAll(".meridiem");
            const CLOCK_REFRACTION = document.querySelector(".clock__refraction");

            const DIVIDER_COLOR = "#ffffff";
            const MESSAGES = [
                "Digital clock - Brandon Weaver",
                "Built with HTML, CSS, and plain old JavaScript",
                "Thanks for checking it out!"
            ];
            /* <- constants */

            /* variables -> */
            let on = true;
            let displayColor = "#ffffff";
            let offStateDisplayColor = "#ffffff";
            let currentlySelectedColorButton = COLOR_SELECTOR_BUTTONS[0];
            let meridiem = "AM";
            let currentMessage = 0;
            /* <- variables */

            // color dividers
            for (const dot of DOTS) {
                dot.style.backgroundColor = DIVIDER_COLOR;
            }

            // colorSelectorButton -> removes the box shadow of this button while setting the box shadow of all other color selector buttons
            const setSelectedColorSelectorButton = colorSelectorButton => {
                for (const button of COLOR_SELECTOR_BUTTONS)
                    button.style.boxShadow = "0 5px 5px #050505";
                colorSelectorButton.style.boxShadow = "none";
            }

            // meridiem -> "AM" or "PM"
            // the proper meridiem is set accordingly
            const setMeridiem = meridiem => {
                if (meridiem === "AM") {
                    MERIDIEMS[0].style.color = "#ffffff";
                    MERIDIEMS[1].style.color = "#ffffff05";
                }
                else {
                    MERIDIEMS[0].style.color = "#ffffff05";
                    MERIDIEMS[1].style.color = "#ffffff";
                }
            }

            // result(current time) -> "hhmmss"
            const getCurrentTime = () => {
                const date = new Date().toLocaleString("en-US", {
                    hour12: true,
                    hour: "2-digit",
                    minute: "2-digit",
                    second: "2-digit"
                }).split(':');

                meridiem = date[date.length - 1].split(' ')[1];
                setMeridiem(meridiem);

                date[date.length - 1] = date[date.length - 1].split(' ')[0];

                return date.join('');
            }

            // rgb -> [255, 255, 255]
            // result(hex) -> "#ffffff"
            const convertRgbToHex = rgb => {
                const hex = [];
                for (const value of rgb) {
                    const conversion = parseInt(value).toString(16);
                    hex.push(conversion.length === 1 ? `0${conversion}` : conversion);
                }
                return `#${hex.join('')}`;
            }

            /*
                digit render data ->
                [
                    digit__section top,
                    digit__section top,
                    digit__section right,
                    digit__section right,
                    digit__section bottom,
                    digit__section left,
                    digit__section left
                ]
                0 -> off
                1 -> on
            */
            const empty = [0, 0, 0, 0, 0, 0, 0];
            const zero = [1, 0, 1, 1, 1, 1, 1];
            const one = [0, 0, 1, 1, 0, 0, 0];
            const two = [1, 1, 1, 0, 1, 1, 0];
            const three = [1, 1, 1, 1, 1, 0, 0];
            const four = [0, 1, 1, 1, 0, 0, 1];
            const five = [1, 1, 0, 1, 1, 0, 1];
            const six = [1, 1, 0, 1, 1, 1, 1];
            const seven = [1, 0, 1, 1, 0, 0, 0];
            const eight = [1, 1, 1, 1, 1, 1, 1];
            const nine = [1, 1, 1, 1, 0, 0, 1];
            /*
                <- digit render data
            */

            // takes an array of digit render data and changes the digit boxes digit sections according to that data
            const render = (digitRenderData, digitBox) => {
                for (let i = 0; i < digitRenderData.length; i++) {
                    if (digitRenderData[i] === 1)
                        digitBox.children[i].style.backgroundColor = displayColor;
                    else if (!on)
                        digitBox.children[i].style.backgroundColor = `${offStateDisplayColor}05`;
                    else
                        digitBox.children[i].style.backgroundColor = `${displayColor}05`;
                }
            }
            
            // number -> integer representation of the digit to be rendered
            // digitBox -> the element responsible for rendering the number
            const renderFromNumber = (number, digitBox) => {
                switch(number) {
                    case 0:
                        render(zero, digitBox);
                        break;
                    case 1:
                        render(one, digitBox);
                        break;
                    case 2:
                        render(two, digitBox);
                        break;
                    case 3:
                        render(three, digitBox);
                        break;
                    case 4:
                        render(four, digitBox);
                        break;
                    case 5:
                        render(five, digitBox);
                        break;
                    case 6:
                        render(six, digitBox);
                        break;
                    case 7:
                        render(seven, digitBox);
                        break;
                    case 8:
                        render(eight, digitBox);
                        break;
                    case 9:
                        render(nine, digitBox);
                        break;
                    case 10:
                        render(empty, digitBox);
                }
            }

            // renders each digit of the current time sequentially
            const update = (powerDown = false) => {
                const currentTime = getCurrentTime()

                for (let i = 0; i < currentTime.length; i++) {
                    if (powerDown || i === 0 && parseInt(currentTime[i]) === 0)
                        renderFromNumber(10, DIGIT_BOXES[i]);
                    else
                        renderFromNumber(parseInt(currentTime[i]), DIGIT_BOXES[i]);
                }
            }

            // changes the display color of the digital clock to the background color of the element which raised the event
            const changeDisplayColor = e => {
                setSelectedColorSelectorButton(e.target);
                currentlySelectedColorButton = e.target;

                const rgb = e.target.style.backgroundColor;
                const rgbValues = rgb.split('(')[1].split(')')[0].split(", ");
                displayColor = convertRgbToHex(rgbValues);

                if (on) {
                    CLOCK_REFRACTION.style.backgroundColor = displayColor;

                    update();
                }
            }

            const displayMessage = () => {
                if (currentMessage === MESSAGES.length)
                    currentMessage = 0;
                MESSAGE_DISPLAY.innerText = MESSAGES[currentMessage];
                MESSAGE_DISPLAY.style.animation = "scrollMessage 30s infinite linear"
                
                ++currentMessage;
            }

            const switchView = e => {
                if (e.target.id === '0')
                    CLOCK_CONTAINER.style.transform = "rotateX(0deg)";
                else if (e.target.id === '1')
                    CLOCK_CONTAINER.style.transform = "rotateX(-20deg) rotateY(0deg)";
                else if (e.target.id === '2')
                    CLOCK_CONTAINER.style.transform = "rotateX(-45deg) rotateY(45deg)";
                else
                    CLOCK_CONTAINER.style.transform = "rotateX(-45deg) rotateY(-45deg)";
            }

            /* initial conditions -> */
            setSelectedColorSelectorButton(currentlySelectedColorButton);
            CLOCK_REFRACTION.style.backgroundColor = displayColor;
            update();
            let updateInterval = setInterval(update, 1000);
            displayMessage();
            let displayMessageInterval = setInterval(displayMessage, 30000);
            /* <- initial conditions */

            // conditions for power down
            const powerDown = () => {
                if (!on) {
                    powerUp();
                    return;
                }

                clearInterval(updateInterval);
                clearInterval(displayMessageInterval);

                on = false;
                offStateDisplayColor = displayColor;

                update(true);
                MESSAGE_DISPLAY.style.color = "#05050500";
                MESSAGE_DISPLAY.style.animation = "none";
                for (const dot of DOTS)
                    dot.style.backgroundColor = "#ffffff05";
                for (const meridiem of MERIDIEMS)
                    meridiem.style.color = "#ffffff05";
                CLOCK_REFRACTION.style.backgroundColor = "#05050500";
            }

            // conditions for power up
            const powerUp = () => {
                setSelectedColorSelectorButton(currentlySelectedColorButton);
                for (const dot of DOTS)
                    dot.style.backgroundColor = "#ffffff";
                CLOCK_REFRACTION.style.backgroundColor = displayColor;

                on = true;

                update();
                updateInterval = setInterval(update, 1000);

                MESSAGE_DISPLAY.style.color = "#ffffff9b";
                if (currentMessage === 0)
                    currentMessage = MESSAGES[MESSAGES.length - 1];
                else
                    --currentMessage;
                displayMessage();
                displayMessageInterval = setInterval(displayMessage, 30000);
            }
        </script>
    </body>
</html>
