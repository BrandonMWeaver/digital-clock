<!--
    Digital clock

    Author: Brandon Michael Weaver
    Date: May, 21, 2021
-->

<!DOCTYPE html>
<html>
    <head>
        <title>Digital clock</title>
        <link rel="stylesheet" href="./index.css" />
    </head>
    <body>
        <div class="viewport">
            <div class="scene">
                <div class="clock__front face">
                    <div class="display">
                        <div class="message__display">
                            <p></p>
                            <div class="overlay"></div>
                        </div>
                        <div class="date__display">
                            <p></p>
                            <p></p>
                            <p></p>
                            <p></p>
                        </div>
                        <div class="digit__box">
                            <div class="digit__section top" style="border-top-left-radius: 10px; border-top-right-radius: 10px;"></div>
                            <div class="digit__section top" style="top: 50%;"></div>
                            <div class="digit__section right" style="top: 5px; border-top-right-radius: 10px;"></div>
                            <div class="digit__section right" style="bottom: 5px; border-bottom-right-radius: 10px;"></div>
                            <div class="digit__section bottom" style="border-bottom-right-radius: 10px; border-bottom-left-radius: 10px;"></div>
                            <div class="digit__section left" style="bottom: 5px; border-bottom-left-radius: 10px;"></div>
                            <div class="digit__section left" style="top: 5px; border-top-left-radius: 10px;"></div>
                        </div>
                        <div class="digit__box">
                            <div class="digit__section top" style="border-top-left-radius: 10px; border-top-right-radius: 10px;"></div>
                            <div class="digit__section top" style="top: 50%;"></div>
                            <div class="digit__section right" style="top: 5px; border-top-right-radius: 10px;"></div>
                            <div class="digit__section right" style="bottom: 5px; border-bottom-right-radius: 10px;"></div>
                            <div class="digit__section bottom" style="border-bottom-right-radius: 10px; border-bottom-left-radius: 10px;"></div>
                            <div class="digit__section left" style="bottom: 5px; border-bottom-left-radius: 10px;"></div>
                            <div class="digit__section left" style="top: 5px; border-top-left-radius: 10px;"></div>
                        </div>
                        <div class="divider">
                            <div class="dot"></div>
                            <div class="dot"></div>
                        </div>
                        <div class="digit__box">
                            <div class="digit__section top" style="border-top-left-radius: 10px; border-top-right-radius: 10px;"></div>
                            <div class="digit__section top" style="top: 50%;"></div>
                            <div class="digit__section right" style="top: 5px; border-top-right-radius: 10px;"></div>
                            <div class="digit__section right" style="bottom: 5px; border-bottom-right-radius: 10px;"></div>
                            <div class="digit__section bottom" style="border-bottom-right-radius: 10px; border-bottom-left-radius: 10px;"></div>
                            <div class="digit__section left" style="bottom: 5px; border-bottom-left-radius: 10px;"></div>
                            <div class="digit__section left" style="top: 5px; border-top-left-radius: 10px;"></div>
                        </div>
                        <div class="digit__box">
                            <div class="digit__section top" style="border-top-left-radius: 10px; border-top-right-radius: 10px;"></div>
                            <div class="digit__section top" style="top: 50%;"></div>
                            <div class="digit__section right" style="top: 5px; border-top-right-radius: 10px;"></div>
                            <div class="digit__section right" style="bottom: 5px; border-bottom-right-radius: 10px;"></div>
                            <div class="digit__section bottom" style="border-bottom-right-radius: 10px; border-bottom-left-radius: 10px;"></div>
                            <div class="digit__section left" style="bottom: 5px; border-bottom-left-radius: 10px;"></div>
                            <div class="digit__section left" style="top: 5px; border-top-left-radius: 10px;"></div>
                        </div>
                        <div class="divider">
                            <div class="dot"></div>
                            <div class="dot"></div>
                        </div>
                        <div class="digit__box">
                            <div class="digit__section top" style="border-top-left-radius: 10px; border-top-right-radius: 10px;"></div>
                            <div class="digit__section top" style="top: 50%;"></div>
                            <div class="digit__section right" style="top: 5px; border-top-right-radius: 10px;"></div>
                            <div class="digit__section right" style="bottom: 5px; border-bottom-right-radius: 10px;"></div>
                            <div class="digit__section bottom" style="border-bottom-right-radius: 10px; border-bottom-left-radius: 10px;"></div>
                            <div class="digit__section left" style="bottom: 5px; border-bottom-left-radius: 10px;"></div>
                            <div class="digit__section left" style="top: 5px; border-top-left-radius: 10px;"></div>
                        </div>
                        <div class="digit__box">
                            <div class="digit__section top" style="border-top-left-radius: 10px; border-top-right-radius: 10px;"></div>
                            <div class="digit__section top" style="top: 50%;"></div>
                            <div class="digit__section right" style="top: 5px; border-top-right-radius: 10px;"></div>
                            <div class="digit__section right" style="bottom: 5px; border-bottom-right-radius: 10px;"></div>
                            <div class="digit__section bottom" style="border-bottom-right-radius: 10px; border-bottom-left-radius: 10px;"></div>
                            <div class="digit__section left" style="bottom: 5px; border-bottom-left-radius: 10px;"></div>
                            <div class="digit__section left" style="top: 5px; border-top-left-radius: 10px;"></div>
                        </div>
                        <div class="divider">
                            <div class="meridiem">A.M.</div>
                            <div class="meridiem">P.M.</div>
                        </div>
                    </div>
                </div>
                <div class="clock__top face"></div>
                <div class="clock__right face"></div>
                <div class="clock__left face"></div>
                <div class="clock__corner top__right face"></div>
                <div class="clock__corner top__left face"></div>
                <div class="clock__corner bottom__right face"></div>
                <div class="clock__corner bottom__left face"></div>
                <div class="clock__back face">
                    <div class="panel__container">
                        <div class="panel">
                            <p class="engraving">Weaver Electronics</p>
                        </div>
                    </div>
                    <div class="screw" style="top: 25px; left: 25px;">
                        <div class="screw__shading">+</div>
                    </div>
                    <div class="screw" style="top: 25px; right: 25px;">
                        <div class="screw__shading">+</div>
                    </div>
                    <div class="screw" style="bottom: 25px; right: 25px;">
                        <div class="screw__shading">+</div>
                    </div>
                    <div class="screw" style="bottom: 25px; left: 25px;">
                        <div class="screw__shading">+</div>
                    </div>
                </div>
                <div class="clock__refraction">
                    <div class="radius"></div>
                </div>
            </div>
            <header style="top: 25px;">
                <div class="color__selector">
                    <button onclick="changeDisplayColor(event)" style="background-color: #ffffff;"></button>
                    <button onclick="changeDisplayColor(event)" style="background-color: #ff3705;"></button>
                    <button onclick="changeDisplayColor(event)" style="background-color: #ff059b;"></button>
                    <button onclick="changeDisplayColor(event)" style="background-color: #05ff9b;"></button>
                    <button onclick="changeDisplayColor(event)" style="background-color: #059bff;"></button>
                </div>
            </header>
            <div class="label" style="top: 110px; left: 50px; transition: top .5s;">
                <div class="box__line left"></div>
                <p>Color Selector</p>
            </div>
            <div class="view__selector__panel" style="right: 25px;">
                <div class="view__selector">
                    <button id="1" onclick="switchView(event)"></button>
                    <button id="2" onclick="switchView(event)"></button>
                    <button id="3" onclick="switchView(event)"></button>
                    <button id="4" onclick="switchView(event)"></button>
                    <button id="5" onclick="switchView(event)"></button>
                    <button id="6" onclick="switchView(event)"></button>
                    <button id="7" onclick="switchView(event)"></button>
                    <button id="8" onclick="switchView(event)" disabled></button>
                    <button id="9" onclick="switchView(event)"></button>
                </div>
            </div>
            <div class="label" style="top: 285px; right: 25px; transition: right .5s;">
                <p>View Selector</p>
                <div class="box__line right"></div>
            </div>
            <div class="alarm__panel">
                <div class="digit__box">
                    <div class="digit__section top" style="border-top-left-radius: 10px; border-top-right-radius: 10px;"></div>
                    <div class="digit__section top" style="top: 50%;"></div>
                    <div class="digit__section right" style="top: 5px; border-top-right-radius: 10px;"></div>
                    <div class="digit__section right" style="bottom: 5px; border-bottom-right-radius: 10px;"></div>
                    <div class="digit__section bottom" style="border-bottom-right-radius: 10px; border-bottom-left-radius: 10px;"></div>
                    <div class="digit__section left" style="bottom: 5px; border-bottom-left-radius: 10px;"></div>
                    <div class="digit__section left" style="top: 5px; border-top-left-radius: 10px;"></div>
                </div>
                <div class="digit__box">
                    <div class="digit__section top" style="border-top-left-radius: 10px; border-top-right-radius: 10px;"></div>
                    <div class="digit__section top" style="top: 50%;"></div>
                    <div class="digit__section right" style="top: 5px; border-top-right-radius: 10px;"></div>
                    <div class="digit__section right" style="bottom: 5px; border-bottom-right-radius: 10px;"></div>
                    <div class="digit__section bottom" style="border-bottom-right-radius: 10px; border-bottom-left-radius: 10px;"></div>
                    <div class="digit__section left" style="bottom: 5px; border-bottom-left-radius: 10px;"></div>
                    <div class="digit__section left" style="top: 5px; border-top-left-radius: 10px;"></div>
                </div>
                <div class="buttons__container">
                    <button class="time__button" onclick="alarmHourUp()">
                        <div class="overlay top"></div>
                    </button>
                    <button class="time__button" onclick="alarmHourDown()">
                        <div class="overlay bottom"></div>
                    </button>
                </div>
                <div class="digit__box">
                    <div class="digit__section top" style="border-top-left-radius: 10px; border-top-right-radius: 10px;"></div>
                    <div class="digit__section top" style="top: 50%;"></div>
                    <div class="digit__section right" style="top: 5px; border-top-right-radius: 10px;"></div>
                    <div class="digit__section right" style="bottom: 5px; border-bottom-right-radius: 10px;"></div>
                    <div class="digit__section bottom" style="border-bottom-right-radius: 10px; border-bottom-left-radius: 10px;"></div>
                    <div class="digit__section left" style="bottom: 5px; border-bottom-left-radius: 10px;"></div>
                    <div class="digit__section left" style="top: 5px; border-top-left-radius: 10px;"></div>
                </div>
                <div class="digit__box">
                    <div class="digit__section top" style="border-top-left-radius: 10px; border-top-right-radius: 10px;"></div>
                    <div class="digit__section top" style="top: 50%;"></div>
                    <div class="digit__section right" style="top: 5px; border-top-right-radius: 10px;"></div>
                    <div class="digit__section right" style="bottom: 5px; border-bottom-right-radius: 10px;"></div>
                    <div class="digit__section bottom" style="border-bottom-right-radius: 10px; border-bottom-left-radius: 10px;"></div>
                    <div class="digit__section left" style="bottom: 5px; border-bottom-left-radius: 10px;"></div>
                    <div class="digit__section left" style="top: 5px; border-top-left-radius: 10px;"></div>
                </div>
                <div class="buttons__container">
                    <button class="time__button" onclick="alarmMinuteUp()">
                        <div class="overlay top"></div>
                    </button>
                    <button class="time__button" onclick="alarmMinuteDown()">
                        <div class="overlay bottom"></div>
                    </button>
                </div>
                <div class="buttons__container" style="margin-left: 10px;">
                    <button class="meridiem__button">A.M.</button>
                    <button class="meridiem__button">P.M.</button>
                </div>
                <div class="buttons__container" style="margin-left: 10px;">
                    <button class="alarm__on__off" onclick="changeAlarmState()"></button>
                    <button class="disable__alarm" onclick="disableAlarm()"></button>
                </div>
            </div>
            <footer>
                <div class="footer__panel">
                    <button class="on__off" onclick="powerDown()">
                        <div class="overlay"></div>
                    </button>
                    <div class="label" style="top: 12.5px; left: calc(50% + 25px);">
                        <div class="line"></div>
                        <p>Power</p>
                    </div>
                    <div class="rotate__scene__button__container">
                        <div class="rotate__scene__button__border">
                            <button onclick="rotateScene()"></button>
                        </div>
                    </div>
                    <div class="label" style="top: 12.5px; left: 75px;">
                        <div class="line"></div>
                        <p>Rotate</p>
                    </div>
                </div>
            </footer>
            <button class="hide__show" style="top: 100px; right: calc(50% - 5px); transform: rotate(180deg); transition: top .5s;" onclick="hideOrShowColorSelector()"></button>
            <button class="hide__show" style="top: 200px; right: 175px; transform: rotate(-90deg); transition: right .5s;" onclick="hideOrShowViewSelector()"></button>
        </div>
        <script>
            /* constants -> */
            const DOC_ROOT = document.querySelector(":root");

            const KEYBOARD = { keys: [], disabled: false };
            addEventListener("keydown", e => KEYBOARD.keys[e.keyCode] = true);
            addEventListener("keyup", e => KEYBOARD.keys[e.keyCode] = false);

            const HEADER = document.querySelector("header");
            const LABELS = document.querySelectorAll(".label");
            const HIDE_SHOW_BUTTONS = document.querySelectorAll(".hide__show");
            const COLOR_SELECTOR_BUTTONS = document.querySelectorAll(".color__selector button");
            const VIEW_SELECTOR_PANEL = document.querySelector(".view__selector__panel");
            const VIEW_SELECTOR_BUTTONS = document.querySelectorAll(".view__selector button");
            const ALARM_DIGIT_BOXES = document.querySelectorAll(".alarm__panel .digit__box");
            const ALARM_BUTTONS = document.querySelectorAll(".alarm__panel .time__button");
            const MERIDIEM_BUTTONS = document.querySelectorAll(".alarm__panel .meridiem__button");
            const ALARM_ON_OFF_BUTTON = document.querySelector(".alarm__panel .alarm__on__off");
            const DISABLE_ALARM_BUTTON = document.querySelector(".alarm__panel .disable__alarm");
            const ROTATE_SCENE_BUTTON_CONTAINER = document.querySelector(".rotate__scene__button__container");
            const SCENE = document.querySelector(".scene");
            const MESSAGE_DISPLAY = document.querySelector(".message__display");
            const MESSAGE = MESSAGE_DISPLAY.children[0];
            const DATE_DISPLAY = document.querySelectorAll(".date__display p");
            const DISPLAY_DIGIT_BOXES = document.querySelectorAll(".display .digit__box");
            const DOTS = document.querySelectorAll(".dot");
            const MERIDIEMS = document.querySelectorAll(".meridiem");
            const ENGRAVING = document.querySelector(".engraving");
            const CLOCK_REFRACTION = document.querySelector(".clock__refraction");

            const DIVIDER_COLOR = "#ffffff";
            const MESSAGES = [
                "Digital clock - Brandon Weaver",
                "Built with HTML, CSS, and plain old JavaScript",
                "Thanks for checking it out!"
            ];
            const BEEP = new Audio("./beep.wav");
            /* <- constants */

            /* variables -> */
            let on = true;
            let selectedViewId = 8;
            let viewSelectorLocked = false;
            let displayColor = "#ffffff";
            let offStateDisplayColor = "#ffffff";
            let currentlySelectedColorButton = COLOR_SELECTOR_BUTTONS[0];
            let meridiem = "AM";
            let currentMessageIndex = 0;
            let alarmTime = "120000 AM";
            let alarmSet = false;
            let alarmEnabled = false;
            /* <- variables */

            const hideOrShowColorSelector = () => {
                if (HEADER.style.top === "25px") {
                    HEADER.style.top = "-75px";
                    HIDE_SHOW_BUTTONS[0].style.top = "0";
                    HIDE_SHOW_BUTTONS[0].style.transform = "rotate(0deg)";
                    LABELS[0].style.top = "10px";
                }
                else {
                    HEADER.style.top = "25px";
                    HIDE_SHOW_BUTTONS[0].style.top = "100px";
                    HIDE_SHOW_BUTTONS[0].style.transform = "rotate(180deg)";
                    LABELS[0].style.top = "110px";
                }
            }

            const hideOrShowViewSelector = () => {
                if (VIEW_SELECTOR_PANEL.style.right === "25px") {
                    VIEW_SELECTOR_PANEL.style.right = "-150px";
                    HIDE_SHOW_BUTTONS[1].style.right = "0";
                    HIDE_SHOW_BUTTONS[1].style.transform = "rotate(90deg)";
                    LABELS[1].style.right = "10px";
                }
                else {
                    VIEW_SELECTOR_PANEL.style.right = "25px";
                    HIDE_SHOW_BUTTONS[1].style.right = "175px";
                    HIDE_SHOW_BUTTONS[1].style.transform = "rotate(-90deg)";
                    LABELS[1].style.right = "25px";
                }
            }

            // colorSelectorButton -> removes the box shadow of this button while setting the box shadow of all other color selector buttons
            const setSelectedColorSelectorButton = colorSelectorButton => {
                for (const button of COLOR_SELECTOR_BUTTONS) {
                    button.disabled = false;
                    button.style.boxShadow = "0 5px 5px #050505";
                }
                colorSelectorButton.disabled = true;
                colorSelectorButton.style.boxShadow = "none";
            }

            // meridiem -> "AM" or "PM"
            // the proper meridiem is set accordingly
            const setMeridiem = meridiem => {
                if (meridiem === "AM") {
                    MERIDIEMS[0].style.color = "#ffffff";
                    MERIDIEMS[1].style.color = "#ffffff05";
                }
                else {
                    MERIDIEMS[0].style.color = "#ffffff05";
                    MERIDIEMS[1].style.color = "#ffffff";
                }
            }

            // result(current time) -> ["hhmmss", [ddd, mmm, d, y]]
            const getCurrentTime = () => {
                let time = new Date().toLocaleString("en-US", {
                    hour12: true,
                    hour: "2-digit",
                    minute: "2-digit",
                    second: "2-digit",
                    weekday: "short",
                    day: "2-digit",
                    month: "short",
                    year: "2-digit"
                }).split(':');

                const date = time[0].slice(0, -4).split(", ");
                const separatedDayInfo = date[1].split(' ');
                date[1] = separatedDayInfo[0];
                date.splice(2, 0, separatedDayInfo[1]);

                time = [time[0].slice(-2), time[1], time[2]];

                if (on && alarmSet && time.join('') === alarmTime)
                    enableAlarm();

                meridiem = time[time.length - 1].split(' ')[1];
                setMeridiem(meridiem);

                time[time.length - 1] = time[time.length - 1].split(' ')[0];

                return [time.join(''), date];
            }

            // rgb -> [255, 255, 255]
            // result(hex) -> "#ffffff"
            const convertRgbToHex = rgb => {
                const hex = [];
                for (const value of rgb) {
                    const conversion = parseInt(value).toString(16);
                    hex.push(conversion.length === 1 ? `0${conversion}` : conversion);
                }
                return `#${hex.join('')}`;
            }

            /*
                digit render data ->
                [
                    digit__section top,
                    digit__section top,
                    digit__section right,
                    digit__section right,
                    digit__section bottom,
                    digit__section left,
                    digit__section left
                ]
                0 -> off
                1 -> on
            */
            const empty = [0, 0, 0, 0, 0, 0, 0];
            const zero = [1, 0, 1, 1, 1, 1, 1];
            const one = [0, 0, 1, 1, 0, 0, 0];
            const two = [1, 1, 1, 0, 1, 1, 0];
            const three = [1, 1, 1, 1, 1, 0, 0];
            const four = [0, 1, 1, 1, 0, 0, 1];
            const five = [1, 1, 0, 1, 1, 0, 1];
            const six = [1, 1, 0, 1, 1, 1, 1];
            const seven = [1, 0, 1, 1, 0, 0, 0];
            const eight = [1, 1, 1, 1, 1, 1, 1];
            const nine = [1, 1, 1, 1, 0, 0, 1];
            /*
                <- digit render data
            */

            // takes an array of digit render data and changes the digit boxes digit sections according to that data
            const render = (digitRenderData, digitBox) => {
                for (let i = 0; i < digitRenderData.length; i++) {
                    if (digitRenderData[i] === 1)
                        digitBox.children[i].style.backgroundColor = displayColor;
                    else if (!on)
                        digitBox.children[i].style.backgroundColor = `${offStateDisplayColor}05`;
                    else
                        digitBox.children[i].style.backgroundColor = `${displayColor}05`;
                }
            }
            
            // number -> integer representation of the digit to be rendered
            // digitBox -> the element responsible for rendering the number
            const renderFromNumber = (number, digitBox) => {
                switch(number) {
                    case 0:
                        render(zero, digitBox);
                        break;
                    case 1:
                        render(one, digitBox);
                        break;
                    case 2:
                        render(two, digitBox);
                        break;
                    case 3:
                        render(three, digitBox);
                        break;
                    case 4:
                        render(four, digitBox);
                        break;
                    case 5:
                        render(five, digitBox);
                        break;
                    case 6:
                        render(six, digitBox);
                        break;
                    case 7:
                        render(seven, digitBox);
                        break;
                    case 8:
                        render(eight, digitBox);
                        break;
                    case 9:
                        render(nine, digitBox);
                        break;
                    case 10:
                        render(empty, digitBox);
                }
            }

            // result [x, y]
            const getSceneTransformCoords = () => {
                let coords = [
                    parseFloat(SCENE.style.transform.split("rotateX(")[1].split("turn)")[0]),
                    parseFloat(SCENE.style.transform.split("rotateY(")[1].split("turn)")[0])
                ];

                coords[1] = coords[1] > .5 ? coords[1] - 1 : coords[1] < -.5 ? coords[1] + 1 : coords[1];

                return coords;
            }

            // renders each digit of the current time sequentially
            const update = (powerDown = false) => {
                const [currentTime, currentDate] = getCurrentTime();

                for (let i = 0; i < currentTime.length; i++) {
                    if (powerDown || i === 0 && parseInt(currentTime[i]) === 0)
                        renderFromNumber(10, DISPLAY_DIGIT_BOXES[i]);
                    else
                        renderFromNumber(parseInt(currentTime[i]), DISPLAY_DIGIT_BOXES[i]);
                }

                for (let i = 0; i < currentDate.length; i++)
                    DATE_DISPLAY[i].innerText = currentDate[i];

                for (let i = 0; i < ALARM_DIGIT_BOXES.length; i++) {
                    if (powerDown || i === 0 && parseInt(alarmTime.split(' ')[0][i]) === 0)
                        renderFromNumber(10, ALARM_DIGIT_BOXES[i]);
                    else
                        renderFromNumber(parseInt(alarmTime.split(' ')[0][i]), ALARM_DIGIT_BOXES[i]);
                }
            }

            // changes the display color of the digital clock to the background color of the element which raised the event
            const changeDisplayColor = e => {
                setSelectedColorSelectorButton(e.target);
                currentlySelectedColorButton = e.target;

                const rgb = e.target.style.backgroundColor;
                const rgbValues = rgb.split('(')[1].split(')')[0].split(", ");
                displayColor = convertRgbToHex(rgbValues);

                if (on) {
                    CLOCK_REFRACTION.style.backgroundColor = displayColor;

                    update();
                }
            }

            const displayMessage = () => {
                if (currentMessageIndex === MESSAGES.length)
                    currentMessageIndex = 0;
                MESSAGE.innerText = MESSAGES[currentMessageIndex];
                MESSAGE.style.animation = "scrollMessage 30s infinite linear";
                
                ++currentMessageIndex;
            }

            // coords -> [currentX, currentY]
            // sets the engraving text shadow property to mimic an engraving
            const setEngravingShadow = coords => {
                let shadowY = 0;
                coords[0] < -.025 && coords[0] > -.475 ? shadowY = 1 : shadowY = -1;

                if (coords[1] < 0)
                    ENGRAVING.style.textShadow = `${coords[0] < -.25 ? -2 : 2}px ${shadowY}px 0 #1e1e1e`;
                else
                    ENGRAVING.style.textShadow = `${coords[0] < -.25 ? 2 : -2}px ${shadowY}px 0 #1e1e1e`;
            }

            const switchView = e => {
                e.target.disabled = true;
                disableViewSelector();
                viewSelectorLocked = true;
                KEYBOARD.disabled = true;
                ROTATE_SCENE_BUTTON_CONTAINER.children[0].children[0].disabled = true;

                SCENE.style.transition = "transform 1s ease-in-out";
                ROTATE_SCENE_BUTTON_CONTAINER.children[0].style.transition = "transform 1s ease-in-out";

                let [x, y] = getSceneTransformCoords();

                switch(parseInt(e.target.id)) {
                    case 1:
                        [x, y] = [-.125, .125];
                        break;
                    case 2:
                        [x, y] = [-.125, 0];
                        break;
                    case 3:
                        [x, y] = [-.125, -.125];
                        break;
                    case 4:
                        [x, y] = [-.0625, .125];
                        break;
                    case 5:
                        [x, y] = [-.0625, 0];
                        break;
                    case 6:
                        [x, y] = [-.0625, -.125];
                        break;
                    case 7:
                        [x, y] = [0, .125];
                        break;
                    case 8:
                        [x, y] = [0, 0];
                        break;
                    case 9:
                        [x, y] = [0, -.125];
                }

                SCENE.style.transform = `rotateX(${x}turn) rotateY(${y}turn)`;
                ROTATE_SCENE_BUTTON_CONTAINER.children[0].style.transform = `rotate(${y}turn)`;

                setTimeout(() => {
                    SCENE.style.transition = "none";
                    ROTATE_SCENE_BUTTON_CONTAINER.children[0].style.transition = "none";

                    selectedViewId = parseInt(e.target.id);
                    enableViewSelector();
                    viewSelectorLocked = false;

                    KEYBOARD.disabled = false;
                    ROTATE_SCENE_BUTTON_CONTAINER.children[0].children[0].disabled = false;
                }, 1000);
            }

            const updateScene = () => {
                let coords = getSceneTransformCoords();

                if (!KEYBOARD.disabled) {
                    if (KEYBOARD.keys[38] && coords[0] !== -.5)
                        coords[0] -= .0025;
                    if (KEYBOARD.keys[40] && coords[0] !== 0)
                        coords[0] += .0025;
                    if (KEYBOARD.keys[37])
                        coords[1] += .0025;
                    if (KEYBOARD.keys[39])
                        coords[1] -= .0025;
                }

                if (!viewSelectorLocked) {
                    for (const button of VIEW_SELECTOR_BUTTONS)
                        button.disabled = false;

                    if (coords[0] === -.125 && coords[1] === .125)
                        VIEW_SELECTOR_BUTTONS[0].disabled = true;
                    else if (coords[0] === -.125 && coords[1] === 0)
                        VIEW_SELECTOR_BUTTONS[1].disabled = true;
                    else if (coords[0] === -.125 && coords[1] === -.125)
                        VIEW_SELECTOR_BUTTONS[2].disabled = true;
                    else if (coords[0] === -.0625 && coords[1] === .125)
                        VIEW_SELECTOR_BUTTONS[3].disabled = true;
                    else if (coords[0] === -.0625 && coords[1] === 0)
                        VIEW_SELECTOR_BUTTONS[4].disabled = true;
                    else if (coords[0] === -.0625 && coords[1] === -.125)
                        VIEW_SELECTOR_BUTTONS[5].disabled = true;
                    else if (coords[0] === 0 && coords[1] === .125)
                        VIEW_SELECTOR_BUTTONS[6].disabled = true;
                    else if (coords[0] === 0 && coords[1] === 0)
                        VIEW_SELECTOR_BUTTONS[7].disabled = true;
                    else if (coords[0] === 0 && coords[1] === -.125)
                    VIEW_SELECTOR_BUTTONS[8].disabled = true;
                }

                setEngravingShadow(coords);

                SCENE.style.transform = `rotateX(${coords[0]}turn) rotateY(${coords[1]}turn)`;
                ROTATE_SCENE_BUTTON_CONTAINER.children[0].style.transform = `rotate(${coords[1]}turn)`;
            }

            const disableViewSelector = () => {
                for (const button of VIEW_SELECTOR_BUTTONS)
                    button.disabled = true;
            }

            const enableViewSelector = () => {
                for (const button of VIEW_SELECTOR_BUTTONS) {
                    if (selectedViewId != button.id)
                        button.disabled = false;
                }
            }

            const rotateScene = () => {
                ROTATE_SCENE_BUTTON_CONTAINER.children[0].children[0].disabled = true;
                disableViewSelector();
                viewSelectorLocked = true;
                KEYBOARD.disabled = true;

                const [currentX, currentY] = getSceneTransformCoords();
                DOC_ROOT.style.setProperty("--currentX", `${currentX}turn`);
                DOC_ROOT.style.setProperty("--currentY", `${currentY}turn`);

                ROTATE_SCENE_BUTTON_CONTAINER.children[0].style.animation = "rotateBorder 5s ease-in-out";
                SCENE.style.animation = "rotateScene 5s ease-in-out";

                let engravingShadowYPos = "-1px";
                if (currentX < -.025 && currentX > -.475)
                    engravingShadowYPos = "1px";

                let engravingAnimationOffset = (100 - (100 * Math.abs((currentY + .5) / 1))) * .01;
                if (engravingAnimationOffset < .1)
                    engravingAnimationOffset += .1;
                else if (engravingAnimationOffset > .9)
                    engravingAnimationOffset -= .1;

                ENGRAVING.animate([
                    { textShadow: `-2px ${engravingShadowYPos} 0 #1e1e1e`, offset: engravingAnimationOffset - .1, easing: "ease-in-out" },
                    { textShadow: `2px ${engravingShadowYPos} 0 #1e1e1e`, offset: engravingAnimationOffset + .1, easing: "ease-in-out" }
                ], 5000);

                setTimeout(() => {
                    ROTATE_SCENE_BUTTON_CONTAINER.children[0].style.animation = "none";
                    SCENE.style.animation = "none";

                    ROTATE_SCENE_BUTTON_CONTAINER.children[0].children[0].disabled = false;
                    enableViewSelector();
                    viewSelectorLocked = false;
                    KEYBOARD.disabled = false;
                }, 5000);
            }

            const illuminateAlarmButton = event => {
                if (event.target.type === "submit")
                    event.target.children[0].style.backgroundColor = "#fff";
                else
                    event.target.style.backgroundColor = "#fff";
            }

            const setAlarmMeridiem = event => {
                for (const button of MERIDIEM_BUTTONS)
                    button.style.color = "#ffffff05";
                event.target.style.color = "#fff";

                alarmTime = `${alarmTime.slice(0, 7)}${event.target.innerText.split('.').join('')}`;
            }

            /* initial conditions -> */
            for (const dot of DOTS) {
                dot.style.backgroundColor = DIVIDER_COLOR;
            }
            setSelectedColorSelectorButton(currentlySelectedColorButton);
            for (const button of ALARM_BUTTONS) {
                button.addEventListener("mousedown", illuminateAlarmButton);
                button.addEventListener("mouseup", () => button.children[0].style.backgroundColor = "#ffffff05");
            }
            MERIDIEM_BUTTONS[0].style.color = "#ffffff";
            MERIDIEM_BUTTONS[1].style.color = "#ffffff05";
            for (const button of MERIDIEM_BUTTONS)
                button.addEventListener("click", setAlarmMeridiem);
            ALARM_ON_OFF_BUTTON.style.backgroundColor = "#ffffff05";
            DISABLE_ALARM_BUTTON.disabled = true;
            DISABLE_ALARM_BUTTON.style.backgroundColor = "#ff050505";
            SCENE.style.transform = "rotateX(0turn) rotateY(0turn)";
            CLOCK_REFRACTION.style.backgroundColor = displayColor;
            update();
            let updateClockInterval = setInterval(update, 1000);
            displayMessage();
            let displayMessageInterval = setInterval(displayMessage, 30000);
            let updateSceneInterval = setInterval(updateScene, 20);
            let alarmInterval;
            /* <- initial conditions */

            const changeAlarmState = () => {
                if (on) {
                    alarmSet = !alarmSet;

                    ALARM_ON_OFF_BUTTON.style.backgroundColor = alarmSet ? "#fff" : "#ffffff05";
                }
            }

            const enableAlarm = () => {
                alarmEnabled = true;
                DISABLE_ALARM_BUTTON.disabled = false;
                alarmInterval = setInterval(() => {
                    BEEP.play();
                    DISABLE_ALARM_BUTTON.style.backgroundColor = DISABLE_ALARM_BUTTON.style.backgroundColor === "rgba(255, 5, 5, 0.02)" ? "#ff0505" : "#ff050505";
                }, 250);
            }

            const disableAlarm = () => {
                alarmEnabled = false;
                DISABLE_ALARM_BUTTON.disabled = true;
                DISABLE_ALARM_BUTTON.style.backgroundColor = "#ff050505";
                clearInterval(alarmInterval);
            }

            const alarmHourUp = () => {
                if (on) {
                    let newHour = parseInt(alarmTime.slice(0, 2)) + 1;
                    if (newHour > 12)
                        newHour = 1;

                    alarmTime = `${newHour < 10 ? `0${newHour}` : newHour}${alarmTime.slice(2, 9)}`;

                    update();
                }
            }

            const alarmHourDown = () => {
                if (on) {
                    let newHour = parseInt(alarmTime.slice(0, 2)) - 1;
                    if (newHour < 1)
                        newHour = 12;

                    alarmTime = `${newHour < 10 ? `0${newHour}` : newHour}${alarmTime.slice(2, 9)}`;

                    update();
                }
            }

            const alarmMinuteUp = () => {
                if (on) {
                    let newMinute = parseInt(alarmTime.slice(2, 4)) + 1;
                    if (newMinute > 59)
                        newMinute = 0;

                    alarmTime = `${alarmTime.slice(0, 2)}${newMinute < 10 ? `0${newMinute}` : newMinute}${alarmTime.slice(4, 9)}`;

                    update();
                }
            }

            const alarmMinuteDown = () => {
                if (on) {
                    let newMinute = parseInt(alarmTime.slice(2, 4)) - 1;
                    if (newMinute < 0)
                        newMinute = 59;
                    
                    alarmTime = `${alarmTime.slice(0, 2)}${newMinute < 10 ? `0${newMinute}` : newMinute}${alarmTime.slice(4, 9)}`;

                    update();
                }
            }

            // conditions for power down
            const powerDown = () => {
                if (!on) {
                    powerUp();
                    return;
                }

                clearInterval(updateClockInterval);
                clearInterval(displayMessageInterval);

                on = false;
                offStateDisplayColor = displayColor;
                if (alarmEnabled)
                    disableAlarm();

                update(true);
                MESSAGE.style.color = "#05050500";
                for (const dot of DOTS)
                    dot.style.backgroundColor = "#ffffff05";
                for (const meridiem of MERIDIEMS)
                    meridiem.style.color = "#ffffff05";
                for (const section of DATE_DISPLAY)
                    section.style.color = "#050505";
                CLOCK_REFRACTION.style.backgroundColor = "#05050500";

                for (const button of ALARM_BUTTONS)
                    button.removeEventListener("mousedown", illuminateAlarmButton);
                for (const button of MERIDIEM_BUTTONS)
                    button.style.color = "#ffffff05";
                ALARM_ON_OFF_BUTTON.style.backgroundColor = "#ffffff05";
            }

            // conditions for power up
            const powerUp = () => {
                setSelectedColorSelectorButton(currentlySelectedColorButton);
                for (const dot of DOTS)
                    dot.style.backgroundColor = "#ffffff";
                CLOCK_REFRACTION.style.backgroundColor = displayColor;

                on = true;

                update();
                updateClockInterval = setInterval(update, 1000);

                MESSAGE.remove();
                MESSAGE_DISPLAY.prepend(MESSAGE);
                MESSAGE.style.color = "#ffffff9b";
                if (currentMessageIndex === 0)
                    currentMessageIndex = MESSAGES[MESSAGES.length - 1];
                else
                    --currentMessageIndex;
                displayMessage();
                displayMessageInterval = setInterval(displayMessage, 30000);

                for (const section of DATE_DISPLAY)
                    section.style.color = "#ffffff9b";

                for (const button of ALARM_BUTTONS)
                    button.addEventListener("mousedown", illuminateAlarmButton)
                for (const button of MERIDIEM_BUTTONS)
                    if (button.innerText.split('.').join('') === alarmTime.slice(-2))
                        button.style.color = "#fff";
                if (alarmSet)
                    ALARM_ON_OFF_BUTTON.style.backgroundColor = "#fff";
            }
        </script>
    </body>
</html>
